<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}">

<head>
    <title>책마루 :: [[${item.b_name}]]</title>
</head>

<div id="view" class="content-wrap" layout:fragment="content">
    <h2 class="title"></h2>

    <div class="content">
        <div class="item-wrap list">
            <div class="item">
                <img th:src="${item.b_thumbnail}" th:alt="${item.b_name}" class="thum">

                <div class="info">
                    <div class="name ellipsis">[[${item.b_name}]]</div>
                    <div class="author ellipsis">[[${item.b_author}]]</div>
                    <div class="price ellipsis">[[${item.b_price}]]</div>
                    <div class="introduce">[[${item.b_introduce}]]</div>
                    <div class="publisher ellipsis">
                        [[${item.b_publisher}]] /
                        [[${item.b_publish_date}]]
                    </div>
                </div>
            </div>

            <div class="payment-btn-wrap">
                <a href="#" class="btn">찜하기</a>
                <a href="#" class="btn main">장바구니</a>
                <a href="#" class="btn sub">바로결제</a>
            </div>
        </div>

        <div class="review-wrap">
            <div class="review-write">
                <form th:action="@{/review/write_confirm}" name="review_write_form" method="post" class="form">
                    <input type="hidden" name="b_no" th:value="${item.b_no}" />
                    <textarea name="r_text" cols="30" rows="10" placeholder="리뷰 내용을 작성해주세요."></textarea>
                    <input type="number" name="r_stars">
                    <button type="submit">리뷰 등록</button>
                </form>
            </div>

            <div class="review-list">
                <div class="review-item" th:each="review: ${reviews}">
                    <div class="">[[${review.m_id}]]</div>
                    <div class="" th:if="${review.r_reg_date == review.r_mod_date}">[[${review.r_reg_date}]]</div>
                    <div class="" th:if="${review.r_reg_date != review.r_mod_date}">[[${review.r_reg_date}]] / [[${review.r_mod_date}]]</div>
                    <div class="">[[${review.r_text}]]</div>
                    <div class="">[[${review.r_stars}]]</div>

                    <th:block th:if="${session[loginedMemberDto]?.m_id eq review.m_id}">
                        <div class="review-btn-wrap">
                            <button type="button" class="btn main modify-review">수정</button>
                            <a th:href="@{/review/delete_confirm(r_no=${review.r_no}, b_no=${review.b_no})}" class="btn sub">삭제</a>
                        </div>

                        <div class="modify-wrap" style="display: none;">
                            <form th:action="@{/review/modify_confirm(r_no=${review.r_no})}" name="review_modify_form" method="post" class="form">
                                <input type="hidden" name="b_no" th:value="${review.b_no}" />
                                <textarea name="r_text" cols="30" rows="10" placeholder="리뷰 내용을 작성해주세요.">[[${review.r_text}]]</textarea>
                                <input type="number" name="r_stars" th:value="${review.r_stars}">
                                <button type="submit">리뷰 수정</button>
                            </form>
                        </div>
                    </th:block>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            document.querySelectorAll(".modify-review").forEach(el => {
                el.addEventListener("click", function (e) {

                    let modifyWrap = this.parentElement.nextSibling.nextSibling;

                    if (modifyWrap.style.display == "none") {
                        modifyWrap.style.display = "flex";
                    } else {
                        modifyWrap.style.display = "none";
                    }
                })
            });

        })
    </script>
</div>


</html>